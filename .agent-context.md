# Agent Context: Kotlin Absensi

## Project Overview
**Kotlin Absensi** is the mobile attendance application for Maxmar. It allows employees to check in/out using face recognition and geolocation.

## Tech Stack
- **Language**: Kotlin
- **UI Framework**: Jetpack Compose (MVVM Architecture)
- **DI**: Hilt
- **Network**: Retrofit (connecting to `filament_absensi` backend)
- **Face Recognition**: Google ML Kit (Face Detection/Cropping) + TensorFlow Lite (Embeddings)
- **Notifications**: Firebase Cloud Messaging (FCM)

## Current System State
- **Face Recognition**: Robust in Production.
    - Captures photo -> Detects/Crops Face (Local) -> Generates Embedding -> Matches with Server.
    - **Note**: Requires `APP_URL` to be accessible (HTTPS/ngrok) for reference photo downloads.
- **Timezone**: Dates/Times are ISO 8601 from backend, displayed in device's local timezone (e.g., WIB).
- **Environment**: Supports `dev` and `prod` flavors.

## Security Hardening (Partially Implemented)
- **Client-Side**:
    - **Anti-Mock**: Blocks `isFromMockProvider` locations.
    - **Trusted Time**: Sends `timestamp` (GPS Time) in check-in request.
- **Backend-Side (TODO)**:
    - Needs to update `AttendanceController` to prioritize `request('timestamp')` over `now()` for trusted offline support.

## recent_updates
- **[2026-01-19] v1.2.0**:
    - **Security**: Added Fake GPS detection (Mock Location) and Trusted Time (GPS Timestamp).
- **[2026-01-19] v1.1.0**:
    - **Feature**: Request Camera/Location permissions on Home Screen entry.
    - **Fix**: Local Face Cropping implemented to solve "0% Match" on uncropped server photos.
    - **Fix**: FCM Token Registration payload key corrected (`token`).
    - **UI**: Added Month/Year picker bottom sheet for History.
